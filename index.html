<!DOCTYPE html>
<html>
<head>
    <script>
    // GLOBALS
    var KEYCODE_ENTER = 13;   //usefull keycode
    var KEYCODE_SPACE = 32;   //usefull keycode
    var KEYCODE_UP = 38;    //usefull keycode
    var KEYCODE_LEFT = 37;    //usefull keycode
    var KEYCODE_RIGHT = 39;   //usefull keycode
    var KEYCODE_SHIFT = 16;
    var KEYCODE_W = 87;     //usefull keycode
    var KEYCODE_A = 65;     //usefull keycode
    var KEYCODE_D = 68;     //usefull keycode
    var KEYCODE_S = 83;
    var key_a = true;
    var key_d = true;
    var key_w = true;
    var key_s = true;

    var current_character = null;
    var DEBUG_ME = false;
    </script>

    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link href='http://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet' type='text/css'>
    <script src="easeljs-0.6.1.min.js"></script>
    <script src="http://code.createjs.com/soundjs-0.4.0.min.js"></script>

    <script src="ContentManager.js"></script>
    <script src="Math.js"></script>
    <script src="Button.js"></script>
    <script src="Character.js"></script>
    <script src="interactable/Interactable.js"></script>
    <script src="interactable/Computer.js"></script>
    <script src="interactable/Rocket.js"></script>
    <script src="interactable/Launcher.js"></script>
    <script src="interactable/LauncherClone.js"></script>
    <script src="interactable/Door.js"></script>
    <script src="ComputerManager.js"></script>
    <script src="Hacker.js"></script>
    <script src="State.js"></script>
    <script src="levels/Level.js"></script>
    <script src="levels/level1.js"></script>

    <script>
    var hash_keydown = {}
    var arr_keys = []
    var b_key_release = false;

    var gameState = null;
    var arr_ent = []
    var monster;
    var txt;
    var levelTick = 0;
    var ind_lvl = 0;
    var levels = [];
    levels[0]=Level.prototype.level;

    //***************
    // Keyboard Stuff
    //***************
    //*************************
    // **********************

        function handleSoundLoaded(e)
        {
          createjs.Sound.stop();
          createjs.Sound.play(e.src);
        }
        function text_stuff()
        {
          txt = new createjs.Text("");
          txt.x = 100;
          txt.y = 80;
          txt.rotation = 20;
          //txt.outline = true;
          stage.addChild(txt);
          txt = new createjs.Text("10.00", "36px Courier", "#76EE00");
          txt.x = canvas.width/2;
          txt.y = 310;
          txt.rotation = 1;
          txt.textAlign ="center";
          //txt.outline = true;
          stage.addChild(txt);

          // this shape will be the background for the text:
        }
        function init()
        {
          canvas = document.getElementById("demoCanvas");
          stage = new createjs.Stage(canvas);
          screen_width = canvas.width;
          screen_height = canvas.height;

          contentManager = new ContentManager();
          contentManager.SetDownloadCompleted(startGame);
          contentManager.StartDownload();

          init_listeners();
          createjs.Ticker.addListener(window);
          createjs.Ticker.setInterval(1000/80);
          createjs.Ticker.setFPS(60)

          createjs.Sound.addEventListener("fileload", handleSoundLoaded);
          // createjs.Sound.registerSound({id:"main", src:"audio/Danger-07-46.mp3"});
          createjs.Sound.registerManifest([
          {id:"main", src:"audio/Danger-07-46.mp3"}
          ]);
        }
        function startGame()
        {
          initLevels();
          debugger;
          // level overlay?
          gameState = State.prototype.Game_TitleInit;
        }

        function tick() {
          // Check GameState Altering Inputs;
          var g_input=String.fromCharCode(arr_keys[arr_keys.length-1]);
          if(g_input == "R")
          {
            console.log("you hit R HOMES!")
            // restart stuff
            levels[ind_lvl].reset();
            arr_keys.pop();
          }
          else if(arr_keys[arr_keys.length-1] == 16)
          {
            if(levels[ind_lvl].lives > 0)
            {
              levels[ind_lvl].lives--;

              stage.removeAllChildren();

              current_character.state = State.prototype.Hacker_MimicInit;
              Hacker.prototype.arrHackers.push(current_character);
              arr_keys.pop();
              arr_ent =[];
              hash_keydown = {};
              arr_keys = [];
              levels[ind_lvl].level();
              return;
            }
          }
          g_time = createjs.Ticker.getTime();
          gameState();
          stage.update();

        }

       function check_key(keyCode, bool)
       {
          if (keyCode == KEYCODE_A && (key_a == bool))
          {
            key_a = !key_a
            // Forward
          }
         else if(keyCode == KEYCODE_D && (key_d == bool))
          {
            key_d = !key_d
          }
          else if(keyCode == KEYCODE_W && (key_w == bool))
          {
            key_w = !key_w
          }
          else if(keyCode == KEYCODE_S && (key_s == bool))
          {
            key_s = !key_s

          }
      }
      function init_listeners() {
        window.addEventListener('keydown', function (e) {
          // check_key(e.keyCode, true);
          // test
          if(e.keyCode == KEYCODE_SPACE || e.keyCode == 8)e.preventDefault();
          // Incase the elment doesnt exist;
          if(hash_keydown[e.keyCode] != true)
          {
            hash_keydown[e.keyCode] = true;
            arr_keys.push(e.keyCode)
          }
        }, false);

        window.addEventListener('keyup', function (e) {
           e.preventDefault();
           hash_keydown[e.keyCode] = false;
           var i=arr_keys.indexOf(e.keyCode);
           arr_keys.splice(i, 1);
        }, false);
      }

      window.onload = init;

    </script>
</head>
<body  style="background-color: #0A0A0A;">
    <img src="img/title_large.png" class="title">
    <canvas id="demoCanvas" width="500" height="400" style="display: block;margin-left: auto; margin-right: auto; border-style: solid;background-image:url('img/background1.png'); background-repeat: no-repeat; background-color: black;">
        alternate content
    </canvas>
    <div class="instruc">
      You have 10 seconds to solve each puzzle.
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      Controls:
      <ul>
        <li>WASD:<br> Movement Keys.</li><br>
        <li>SPACE+(Any Direction Key): <br>Next to a computer, this will interact with the computer.</li>
        <li><br>ENTER KEY: <br>This will exit a computer.<li>
        <li><br>SHIFT KEY: <br>Time Warp. This will warp back in time, creating an instance of your previous self (All actions will be mimiced).
        <li><br>R KEY: <br>Restart Level.
      </ul>
      ================================
      Icons:<br>
      <img src="img/icon_hacker.png">N   <---- This icon will have a number next to it. It will display the number of 'Time Warps' you have left.
    </div>
</body>
</html>